"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
exports.__esModule = true;
exports.setFlashMessagePr = exports.getFlashMessagePr = void 0;
/**
 * getFlashMessagePr
 * * this is a promise base function
 * * when this function runs, it will return a promise and *delete* your flash message in the session
 * @param req req param is the Request object that you use inside an express middleware
 * @param key key param is actually the title of your flash message
 * @returns a promise
 */
var getFlashMessagePr = function (req, key, config) {
    var storeProperty = config.storeProperty || "flash";
    if (!req.session[storeProperty])
        req.session[storeProperty] = {};
    return new Promise(function (resolve, reject) {
        if (req.session[storeProperty][key]) {
            var msg_1 = req.session[storeProperty][key];
            delete req.session[storeProperty][key];
            req.session.save(function (err) {
                if (err)
                    reject(err);
                else
                    resolve(msg_1);
            });
        }
        else {
            resolve(null);
        }
    });
};
exports.getFlashMessagePr = getFlashMessagePr;
/**
 * setFlashMessagePr
 * * this is a promise base function
 * * when this function runs, it will return a promise and *delete* your flash message in the session
 * @param req req param is the Request object that you use inside an express middleware
 * @param key key param is actually the title of your flash message
 * @param value value param is the datas that you want to store as a flash message. this should be a string or an array of strings
 * @returns a promise
 */
var setFlashMessagePr = function (req, key, value, config) {
    var storeProperty = config.storeProperty || "flash";
    if (!req.session[storeProperty])
        req.session[storeProperty] = {};
    var flashDatas = req.session[storeProperty][key];
    var isValuArray = Array.isArray(value);
    var isSessionDataArray = Array.isArray(flashDatas);
    if (!flashDatas) {
        flashDatas = value;
    }
    else {
        if (isSessionDataArray) {
            if (isValuArray)
                flashDatas = __spreadArray(__spreadArray([], flashDatas, true), value, true);
            else
                flashDatas = __spreadArray(__spreadArray([], flashDatas, true), [value], false);
        }
        else {
            if (isValuArray)
                flashDatas = __spreadArray([flashDatas], value, true);
            else
                flashDatas = [flashDatas, value];
        }
    }
    req.session[storeProperty][key] = flashDatas;
    return new Promise(function (resolve, reject) {
        req.session.save(function (err) {
            if (err)
                reject(err);
            else
                resolve(null);
        });
    });
};
exports.setFlashMessagePr = setFlashMessagePr;
